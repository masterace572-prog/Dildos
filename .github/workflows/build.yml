name: Build UDP Tool

on:
  push:
    tags: ['v*']
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup environment
      run: |
        sudo apt-get update
        sudo apt-get install -y gcc libc6-dev

    - name: Compile for Linux
      run: |
        gcc -o udp_flood_linux udp_flood.c -lpthread -D_GNU_SOURCE -O3 -static
        strip udp_flood_linux

    - name: Compile for Android (Termux)
      run: |
        aarch64-linux-gnu-gcc -o udp_flood_android udp_flood.c -lpthread -D_GNU_SOURCE -O3 -static
        strip udp_flood_android

    - name: Create release
      uses: softprops/action-gh-release@v1
      if: startsWith(github.ref, 'refs/tags/')
      with:
        files: |
          udp_flood_linux
          udp_flood_android
        body: |
          UDP Flood Tool - Compiled Binaries
          
          **Supported Platforms:**
          - `udp_flood_linux`: Linux x86_64
          - `udp_flood_android`: Android/Termux (ARM64)
          
          **Usage:**
          ```bash
          chmod +x udp_flood_linux
          ./udp_flood_linux IP PORT DURATION THREADS
          ```
          
          ⚠️ **Warning:** Use responsibly and only on systems you own.

    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: compiled-binaries
        path: |
          udp_flood_linux
          udp_flood_android
