format_version: '13'
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:
  envs:
    - PYTHON_VERSION: "3.8"

workflows:
  primary:
    steps:
      # Activate Bitrise's Ubuntu environment
      - activate-ssh-key:
          run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
      - git-clone: {}

      # Install system dependencies
      - script:
          title: Install system packages (gcc, util-linux)
          inputs:
            - content: |
                #!/bin/bash
                sudo apt-get update -y
                sudo apt-get install -y gcc util-linux

      # Set up Python
      - script:
          title: Set up Python
          inputs:
            - content: |
                #!/bin/bash
                python3 --version
                python3 -m pip install --upgrade pip

      # Install Python dependencies
      - script:
          title: Install Python packages
          inputs:
            - content: |
                #!/bin/bash
                python3 -m pip install flask telebot pymongo aiohttp

      # Compile and run
      - script:
          title: Build and execute
          inputs:
            - content: |
                #!/bin/bash
                if [ -f soul.c ]; then
                  gcc soul.c -o soul -lpthread
                fi
                chmod +x *
                lscpu
                python3 soul.py
